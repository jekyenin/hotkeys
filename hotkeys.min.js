var Hotkeys=function(e){function n(e){var n,r=o(e);t(r)||g.push(r),(n=c(l,g))&&(n.prevent&&e.preventDefault(),e.repeat||n.func&&(n.func(),p.onDone(n)))}function r(e){var n,r=o(e);t(r)&&(n=g.indexOf(r),g.splice(n,1))}function t(e){return-1!==g.indexOf(e)}function o(e){var n=e.keyCode||e.which||e.charCode;return n=a(n)}function i(e){return y[e]?y[e]:String.fromCharCode(e)}function u(e){for(var n in y)if(y[n]==e)return+n;return+e.charCodeAt(0)}function a(e){return u(i(e).toLowerCase())}function f(){g=[]}function c(e,n){var r,t,o={length:0};for(var i in e)e.hasOwnProperty(i)&&(t=e[i],r=t.codes,d(n,r)&&t.length>o.length&&(o=t));return o.length>0&&o}function d(e,n){for(var r,t={},o=!0,i=0,u=e.length;i<u;i++)r=e[i],t[r]=!0;for(var a=0,f=n.length;a<f;a++)(r=n[a])in t||(o=!1);return o}function s(){document.addEventListener("keydown",n,!1),document.addEventListener("keyup",r,!1),window.addEventListener("blur",f,!1)}function h(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",r),window.removeEventListener("blur",f)}var v=this,g=[],l={},p={onAdd:function(e){},onDone:function(e){},onChange:function(e){},onRemove:function(e){},onTrigger:function(e){},onCreate:function(){},onDestroy:function(){}},y={16:"shift",17:"ctrl",18:"alt",9:"tab",13:"enter",8:"backspace",32:"spacebar"},m=!1;e=e||{},this.add=function(e,n,r){var t;if(void 0===r&&(r=!0),arguments.length<2)throw TypeError("Failed to execute 'add' on 'Hotkeys': 2 arguments required, but "+arguments.length+" present.");if("string"!=typeof e)throw TypeError("The first argument must be a string");if("function"!=typeof n)throw TypeError("The second argument must be a function");t=e.toLowerCase();for(var o,i=t.split("+"),a=[],f=0,c=i.length;f<c;f++)o=i[f],a.push(u(o));var d={combination:e,symbols:i,codes:a,length:a.length,func:n,prevent:r};return m&&(m=!1,s()),l[t]?(l[t]=d,p.onChange(d)):(l[t]=d,p.onAdd(d)),v},this.remove=function(e){var n,r;if(arguments.length<1)throw TypeError("Failed to execute 'remove' on 'Hotkeys': 1 argument required, but "+arguments.length+" present.");if(n=e.toLowerCase(),void 0===l[n])throw TypeError("Hotkey "+e+" is undefined");return r=l[n],delete l[n],p.onRemove(r),v},this.trigger=function(e){var n,r;if(arguments.length<1)throw TypeError("Failed to execute 'trigger' on 'Hotkeys': 1 argument required, but "+arguments.length+" present.");if(r=e.toLowerCase(),void 0===(n=l[r]))throw TypeError("Hotkey "+e+" is undefined");return n.func(),p.onTrigger(n),v},this.destroy=function(){return m=!0,h(),p.onDestroy(),v},function(e){var n;for(var r in p)e.hasOwnProperty(r)&&(p[r]=e[r],delete e[r]);for(var t in e)e.hasOwnProperty(t)&&(n=e[t],v.add(t,n));s(),p.onCreate()}(e)};